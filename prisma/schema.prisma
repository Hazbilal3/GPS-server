generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  driverId  Int?     @unique
  email     String   @unique
  password  String
  userRole  Int
  adminId  Int?
  fullName String?
  phoneNumber String?  @unique  @db.VarChar(20)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  exports   Export[]
  uploads   Upload[]
  resetCodeHash       String?      // hashed code
  resetCodeExpiresAt  DateTime?    // when the code expires
  resetCodeAttempts   Int      @default(0)
}

model Upload {
  id       Int    @id @default(autoincrement())
  driverId Int?   // Should match User.driverId type
  user     User?  @relation(fields: [driverId], references: [driverId])
  barcode        String
  address        String
  gpsLocation    String?
  expectedLat    Float?
  expectedLng    Float?
  distanceKm     Float?
  status         String?
  googleMapsLink String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  exports        Export[]
}

model Export {
  id             Int      @id @default(autoincrement())
  driverId       Int
  barcode        String
  address        String
  gpsLocation    String?
  expectedLat    Float?
  expectedLng    Float?
  distanceKm     Float?
  status         String?
  matches        String
  googleMapsLink String?
  uploadId       Int?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [driverId], references: [id])
  upload         Upload?  @relation(fields: [uploadId], references: [id])
}
